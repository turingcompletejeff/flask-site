{% extends "layout.html" %}

{% block title %}turing completely{% endblock %}

{% block content %}
  <div class="blog-post-strip">
    <h1 class="blog-header">turing complete jeff</h1>

    {% if current_user.is_authenticated and (current_user.has_role('blogger') or current_user.is_admin()) %}
    <a href="{{ url_for('blogpost_bp.new_post') }}" id="blog-post-add">
      <span class="material-symbols-outlined hover-add"></span>
    </a>
    {% endif %}
    
    {% for post in blog_posts %}
        <div class="blog-post">
          {% if current_user.is_authenticated and post.is_draft %}
          <div class="draft-badge">DRAFT</div>
          {% endif %}
          <div class="blog-post-header">
	    {% if post.thumbnail %}
            <img class="blog-thumbnail" 
                 src="{{ url_for('main_bp.uploaded_file', filename=post.thumbnail) }}" />
	    {% endif %}
            <h2>{{ post.title }}</h2>
	    {% if current_user.is_authenticated and (current_user.has_role('blogger') or current_user.is_admin()) %}
            <a class="blog-post-edit" href="{{ url_for('blogpost_bp.edit_post', post_id=post.id) }}">
              <span class="material-symbols-outlined hover-edit"></span>
            </a>
            <div class="blog-post-delete" data-id="{{ post.id }}">
              <span class="material-symbols-outlined hover-delete"></span>
            </div>
	    {% endif %}
          </div>
            
          <hr />
          
          <div>{{ post.content[:255] |safe}}... <a href="{{ url_for('blogpost_bp.view_post', post_id=post.id) }}">Read more</a></div>
          
          <hr />
          <div class="blog-post-timestamps">
            <small >Posted on {{ post.date_posted.strftime('%Y-%m-%d') }}</small>
            {% if post.hasEdits() %}
            <small class="blog-post-edited">Edited on {{ post.last_updated|localtime }}</small>
            {% endif %}
          </div>
        </div>
    {% else %}
        <p>No posts available.</p>
    {% endfor %}
  </div>
{% endblock %}

{% block rightsidebar %}
<div id="right-sidebar">&nbsp;</div>
{% endblock %}

{% block endjs %}
{% if current_user.is_authenticated and (current_user.has_role('blogger') or current_user.is_admin()) %}
<script>
  $(document).ready(function() {
    // delete post
    $(".blog-post-delete").on('click', function() {
      let button = $(this);

      if(button.hasClass("delete-confirm")) {
        // delete the post for real
        $.post("{{ url_for('blogpost_bp.delete_post') }}",
             { id: button.data("id") }, function() {

          button.parents(".blog-post").fadeOut(400,function() {
              $(this).remove();
          });

          addFlashMessage("success","post deleted");
        }).fail(function() {
          addFlashMessage("danger","error deleting post");
        });
      } else {
        // slide out to a confirm button, avoiding accidental clicks
        button.addClass("delete-confirm");
      }
    });
  });
</script>
{% endif %}
{% endblock %}
