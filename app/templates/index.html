{% extends "layout.html" %}

{% block title %}blAg!{% endblock %}

{% block content %}
  <div class="blog-post-strip">
    <h1 class="blog-header">blag</h1>

    {% if current_user.is_authenticated %}
    <div id="blog-post-add">
      <span class="material-symbols-outlined hover-add"></span>
    </div>
    {% endif %}
    
    {% for post in blog_posts %}
        <div class="blog-post">
          <div class="blog-post-header">
            <img class="blog-thumbnail" src="/static/img/{{ post.thumbnail }}" />
            <h2>{{ post.title }}</h2>
            <div class="blog-post-delete">
              <span class="material-symbols-outlined">delete</span>
              <span class="material-symbols-sharp">delete</span>
            </div>
          </div>
            
          <hr />
          
          <p>{{ post.content[:70] }}... <a href="{{ url_for('blogpost_bp.view_post', post_id=post.id) }}">Read more</a></p>
          
          <hr />
          <div class="blog-post-timestamps">
            <small >Posted on {{ post.date_posted.strftime('%Y-%m-%d') }}</small>
            {% if post.hasEdits() %}
            <small class="blog-post-edited">Edited on {{ post.last_updated.strftime('%Y-%m-%d %H:%M') }}</small>
            {% endif %}
          </div>
        </div>
    {% else %}
        <p>No posts available.</p>
    {% endfor %}
  </div>
{% endblock %}

{% block endjs %}
{% if current_user.is_authenticated %}
<script>
  $(document).ready(function() {
    // add post
    $("#blog-post-add").on('click', function() {
      // create a new blog post div
      let postDiv = $("div").addClass("blog-post");
      let headerDiv = $("div").addClass("blog-post-header");
      let titleTag = $("h2");
      let hrTag = $("hr");
      let contentTag = $("p");
      
      // with blank inputs for an image, a title, and content
      let formTag = $("form").attr("method","post");
      let imageInput = $("input").attr("type","file").attr("id","blog-img-input")
                        .attr("name","portrait");
      let titleInput = $("input").attr("type","text").attr("id","blog-title-input")
                        .attr("name","title");
      let contentInput = $("input").attr("type","text").attr("id","blog-content-input")
                          .attr("name","content");
      
      let submitButton = $("button").attr("type","submit");
      
      // assemble divs
      titleTag.append(titleInput);
      headerDiv.append(imageInput).append(titleTag);
      // FIXME --> append a cancel or delete button
      contentTag.append(contentInput);
      postDiv.append(headerDiv).append(hrTag).append(contentTag)
             .append(hrTag).append(submitButton);
    });
    
    // delete post
    
    // edit post
  });
</script>
{% endif %}
{% endblock %}